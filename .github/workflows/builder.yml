name: C++ Builder

on: 
  push:
    branches:
    - master

jobs:
  build-win:
   name: Windows Build
   runs-on: windows-latest
   strategy:
     matrix: 
       conf: [Release]
   steps:
    - name: Download Repository
      uses: actions/checkout@v2
    - name: Setup Environment
      uses: microsoft/setup-msbuild@v1.0.0
    - name: Prerequesits Check
      run: ./tools/prerequesits_win.bat -s
    - name: Generate Solution
      run: ./tools/generate_project_win.bat -s
    - name: Build
      run: MSBuild.exe ./build/elemd.sln /p:Configuration=${{ matrix.conf }}
    - name: Convert Assets
      run: ./tools/convert_assets_win.bat -s
    
  build-linux:
   name: Linux Build
   runs-on: ubuntu-latest
   strategy:
     matrix: 
       conf: [Release]
   steps:
    - name: Download Repository
      uses: actions/checkout@v2
    - name: Setup Environment
      run: |
        sudo chmod +x ./tools/*.sh
    - name: Prerequesits Check
      run: sudo ./tools/prerequesits_nix.sh
    - name: Generate Solution
      run: sudo ./tools/generate_project_linux.sh
    - name: Build
      run: |
        cd ./build
        sudo make config=${{ matrix.conf }}
    - name: Convert Assets
      run: ./tools/convert_assets_linux.sh

  build-mac:
   name: Mac Build
   runs-on: macos-latest
   strategy:
     matrix: 
       conf: [Release]
   steps:
    - name: Download Repository
      uses: actions/checkout@v2
    - name: Setup Environment
      run: |
        sudo chmod +x ./tools/*.sh
    - name: Prerequesits Check
      run: ./tools/prerequesits_nix.sh
    - name: Generate Solution
      run: ./tools/generate_project_mac.sh
    - name: Build
      run: |
        cd ./build
        make config=${{ matrix.conf }}
    - name: Convert Assets
      run: ./tools/convert_assets_mac.sh