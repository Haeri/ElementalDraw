name: C++ Builder

on: 
  push:
    branches:
    - master

jobs:
  build-win:
   name: Windows Build
   runs-on: windows-latest
   strategy:
     matrix: 
       conf: [Debug, Release]
   steps:
    - name: Download Repository
      uses: actions/checkout@v2
      with:
        path: ElementalDraw
    - name: Vulkan Header Download
      uses: actions/checkout@master
      with:
        repository: KhronosGroup/Vulkan-Headers
        path: Vulkan-Headers
    - name: Debug Dir
      run: |
        dir
        cd Vulkan-Headers
        dir
    - name: Setup Environment
      run: setx VULKAN_SDK $GITHUB_WORKSPACE/Vulkan-Headers
    - name: Prerequesits Check
      run: ./ElementalDraw/tools/prerequesits_win.bat -s
    - name: Generate Solution
      run: ./ElementalDraw/tools/generate_project_win.bat -s
    - name: Build
      run: MSBuild.exe ./ElementalDraw/build/Elemental_Draw.sln
    
  build-linux:
   name: Linux Build
   runs-on: ubuntu-latest
   strategy:
     matrix: 
       conf: [Debug, Release]
   steps:
    - name: Download Repository
      uses: actions/checkout@v2
      with:
        path: ElementalDraw
    - name: Vulkan Header Download
      uses: actions/checkout@master
      with:
        repository: KhronosGroup/Vulkan-Headers
        path: Vulkan-Headers
    - name: Setup Environment
      run: |
        export VULKAN_SDK="$GITHUB_WORKSPACE/Vulkan-Headers"
        echo $VULKAN_SDK
        sudo apt install libxinerama-dev libxcursor-dev xorg-dev libglu1-mesa-dev
    - name: Debug Dir
      run: |
        ls -la
        cd Vulkan-Headers
        ls -la
    - name: Prerequesits Check
      run: |
        sudo chmod +x ./ElementalDraw/tools/prerequesits_linux.sh
        sudo ./ElementalDraw/tools/prerequesits_linux.sh
    - name: Generate Solution
      run: |
        sudo chmod +x ./ElementalDraw/tools/generate_project_linux.sh
        sudo ./ElementalDraw/tools/generate_project_linux.sh
    - name: Build
      run: make ./ElementalDraw/build
